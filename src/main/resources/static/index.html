<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>合同管理系统</title>
    <!-- import CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
</head>
<body>
<div id="app">
    <el-container>
        <el-header>
            <el-menu
                    class="el-menu-demo"
                    mode="horizontal"
                    background-color="#545c64"
                    text-color="#fff"
                    active-text-color="#ffd04b">
            </el-menu>
        </el-header>
        <el-main>
            <template>
                <el-tabs v-model="activeName" @tab-click="handleClick">
                    <el-tab-pane label="用户管理" name="user" align="center">
                        <el-table stripe
                                  :data="userData"
                                  style="width: 100%">
                            <el-table-column
                                    prop="id"
                                    label="ID"
                                    width="180">
                            </el-table-column>
                            <el-table-column
                                    prop="name"
                                    label="姓名"
                                    width="180">
                            </el-table-column>
                            <el-table-column
                                    prop="phone"
                                    label="手机"
                                    width="180">
                            </el-table-column>
                            <el-table-column
                                    label="操作"
                                    width="180">
                                <template slot-scope="scope">
                                    <el-button
                                            size="mini"
                                            @click="edit(scope)">编辑
                                    </el-button>
                                    <el-button
                                            size="mini"
                                            type="danger"
                                            @click="remove(scope)">删除
                                    </el-button>
                                </template>
                            </el-table-column>
                        </el-table>
                    </el-tab-pane>
                    <el-tab-pane label="发票管理" name="receipt" align="center">
                        <el-table stripe
                                  :data="receiptData"
                                  style="width: 100%">
                            <el-table-column
                                    prop="id"
                                    label="ID"
                                    width="180">
                            </el-table-column>
                            <el-table-column
                                    prop="title"
                                    label="发票"
                                    width="180">
                            </el-table-column>
                            <el-table-column
                                    prop="time"
                                    label="时间"
                                    width="280">
                            </el-table-column>
                            <el-table-column
                                    prop="consume"
                                    label="消费"
                                    width="180">
                            </el-table-column>
                            <el-table-column
                                    label="操作"
                                    width="180">
                                <template slot-scope="scope">
                                    <el-button
                                            size="mini"
                                            @click="edit(scope)">编辑
                                    </el-button>
                                    <el-button
                                            size="mini"
                                            type="danger"
                                            @click="remove(scope)">删除
                                    </el-button>
                                </template>
                                </el-button>
                            </el-table-column>
                        </el-table>
                    </el-tab-pane>
                    <el-tab-pane label="合同管理" name="contract" align="center">
                        <el-table stripe
                                  :data="contractData"
                                  style="width: 100%">
                            <el-table-column
                                    prop="id"
                                    label="ID"
                                    width="180">
                            </el-table-column>
                            <el-table-column
                                    prop="title"
                                    label="合同"
                                    width="180">
                            </el-table-column>
                            <el-table-column
                                    prop="content"
                                    label="内容"
                                    width="180">
                            </el-table-column>
                            <el-table-column
                                    prop="firstParty"
                                    label="甲方"
                                    width="180">
                            </el-table-column>
                            <el-table-column
                                    prop="secondParty"
                                    label="乙方"
                                    width="180">
                            </el-table-column>
                            <el-table-column
                                    label="操作"
                                    width="180">
                                <template slot-scope="scope">
                                    <el-button
                                            size="mini"
                                            @click="edit(scope)">编辑
                                    </el-button>
                                    <el-button
                                            size="mini"
                                            type="danger"
                                            @click="remove(scope)">删除
                                    </el-button>
                                </template>
                            </el-table-column>
                        </el-table>
                    </el-tab-pane>
                </el-tabs>
            </template>
            <el-dialog title="编辑用户信息" :visible.sync="dialogVisible">
                <el-form :model="form">
                    <el-form-item label="姓名" :label-width="formLabelWidth">
                        <el-input v-model="form.name" autocomplete="off"></el-input>
                    </el-form-item>
                    <el-form-item label="手机号" :label-width="formLabelWidth">
                        <el-input v-model="form.name" autocomplete="off"></el-input>
                    </el-form-item>
<!--                    <el-form-item label="活动区域" :label-width="formLabelWidth">-->
<!--                        <el-select v-model="form.region" placeholder="请选择活动区域">-->
<!--                            <el-option label="区域一" value="shanghai"></el-option>-->
<!--                            <el-option label="区域二" value="beijing"></el-option>-->
<!--                        </el-select>-->
<!--                    </el-form-item>-->
                </el-form>
                <div slot="footer" class="dialog-footer">
                    <el-button @click="dialogFormVisible = false">取 消</el-button>
                    <el-button type="primary" @click="dialogFormVisible = false">确 定</el-button>
                </div>
            </el-dialog>
        </el-main>
        <el-footer></el-footer>
    </el-container>
</div>
</body>
<!-- import Vue before Element -->
<script src="https://unpkg.com/vue/dist/vue.js"></script>
<!-- import JavaScript -->
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<script src="https://cdn.bootcss.com/vue-resource/1.5.1/vue-resource.min.js"></script>
<script>
    let v = new Vue({
        el: '#app',
        data: {
            activeName: 'user',
            userData: [],
            receiptData: [],
            contractData: [],
            dialogVisible: false,
            form: {
                name: '',
                region: '',
                date1: '',
                date2: '',
                delivery: false,
                type: [],
                resource: '',
                desc: ''
            }
        },
        mounted() {
            this.refresh();
        },
        methods: {
            handleClick: function (tab, event) {
                console.log(tab._props.label)
            },
            getUser: function () {
                this.$http.get('http://localhost:8080/user')
                    .then((response) => {
                            this.userData = response.body
                        }
                    )
            },
            getReceipt: function () {
                this.$http.get('http://localhost:8080/receipt')
                    .then((response) => {
                            this.receiptData = response.body
                        }
                    )
            },
            getContract: function () {
                this.$http.get('http://localhost:8080/contract')
                    .then((response) => {
                            this.contractData = response.body
                        }
                    )
            },
            refresh: function () {
                console.log("refresh");
                this.getContract();
                this.getReceipt();
                this.getUser();
            },
            handleEdit(index, row) {
                console.log(index, row);
                this.open()
            },
            handleDelete(index, row) {
                console.log(index, row);
                this.open()
            },
            remove(scope) {
                console.log(scope)
                this.$confirm('此操作将永久删除该信息, 是否继续?', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    let type;
                    if (scope.column.id.startsWith("el-table_1"))
                        type = 'user/';
                    else if (scope.column.id.startsWith("el-table_2"))
                        type = 'receipt/';
                    else
                        type = 'contract/';
                    this.$http.delete('http://localhost:8080/' + type + scope.row.id)
                        .then(() => {
                            this.refresh();
                        });
                    this.$message({
                        type: 'success',
                        message: '删除成功!'
                    });
                }).catch(() => {
                    this.$message({
                        type: 'info',
                        message: '已取消删除'
                    });
                });
            },
            edit: function (scope) {
                this.dialogVisible = true;
            }
        }
    })
</script>
</html>